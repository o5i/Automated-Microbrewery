<!-- <?php echo "--".">";
include_once $_SERVER['DOCUMENT_ROOT'] . '/include/prepend.inc';
siteHeader("Modbus Master Protocol Library / C++ Editions - Examples",
           // Description:
           "Modbus RTU, Modbus ASCII, MODBUS/TCP Master C++ library and driver Documentation",
           // Keywords:
           $keywords);
echo "<"."!--"; if (false) { ?> -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
   <TITLE>FieldTalk Modbus Master Protocol Library / C++ Editions - Examples</TITLE>
   <LINK href="style.css" rel="stylesheet" type="text/css">
</head>
<body>
   <table width="100%"><tr>
   <td valign=bottom><b><font color=black size=4>
      FieldTalk<small><sup>&#153;</sup></small> Modbus<small><sup>&reg;</sup></small> Master Protocol Library<br>
      C++ Editions</font></b></td>
   <td valign=bottom align=right>
      <a href="http://www.focus-sw.com">
      <img src="focuslogo50x200.png" border=0 size="50%"
       alt="FOCUS Software Engineering" ></a></td>
   </tr></table>
   <hr size=4 noshade color=gray>
<!-- <?php } echo "--".">"; echo "<"."!--"; ?> -->

<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a name="examples">Examples</a>
</h1><ul>
<li><a class="el" href="examples.html#example1">Serial Example</a></li><li><a class="el" href="examples.html#example2">MODBUS/TCP Example</a></li><li><a class="el" href="examples.html#example3">Modpoll application</a></li></ul>
<h2><a name="example1"></a>
Serial Example</h2>
The following example sersimple.cpp shows how to configure a serial Modbus protocol and read values:<p>
<div class="fragment"><pre>
<span class="comment">// Platform header</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>

<span class="comment">// Include FieldTalk package header</span>
<span class="preprocessor">#include "MbusAsciiMasterProtocol.hpp"</span>
<span class="preprocessor">#include "MbusRtuMasterProtocol.hpp"</span>


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Gobal data</span>
<span class="comment"> *****************************************************************************/</span>

<span class="preprocessor">#if defined(__LINUX__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/ttyS0"</span>;
<span class="preprocessor">#elif defined(__WIN32__) || defined(__CYGWIN__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"COM1"</span>;
<span class="preprocessor">#elif defined(__FREEBSD__) || defined(__NETBSD__) || defined(__OPENBSD__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/ttyd0"</span>;
<span class="preprocessor">#elif defined(__QNX__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/ser1"</span>;
<span class="preprocessor">#elif defined(__VXWORKS__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/tyCo/0"</span>;
<span class="preprocessor">#elif defined(__IRIX__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/ttyf1"</span>;
<span class="preprocessor">#elif defined(__SOLARIS__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/ttya"</span>;
<span class="preprocessor">#elif defined(__OSF__)</span>
<span class="preprocessor"></span>   <span class="keywordtype">char</span> *portName = <span class="stringliteral">"/dev/tty00"</span>;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#  error Unknown platform, please add an entry for portName</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">//MbusAsciiMasterProtocol mbusProtocol; // Use this declaration for ASCII</span>
<a class="code" href="a00010.html">MbusRtuMasterProtocol</a> mbusProtocol; <span class="comment">// Use this declaration for RTU</span>


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Function implementation</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keywordtype">void</span> openProtocol()
{
   <span class="keywordtype">int</span> result;

   result = mbusProtocol.<a class="code" href="a00010.html#MbusRtuMasterProtocolz3_0">openProtocol</a>(portName,
                                      9600L, <span class="comment">// Baudrate</span>
                                      8,     <span class="comment">// Databits</span>
                                      1,     <span class="comment">// Stopbits</span>
                                      0);    <span class="comment">// Parity</span>
   <span class="keywordflow">if</span> (result != <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
   {
      fprintf(stderr, <span class="stringliteral">"Error opening protocol: %s!\n"</span>,
                       <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
      exit(EXIT_FAILURE);
   }
}


<span class="keywordtype">void</span> closeProtocol()
{
   mbusProtocol.<a class="code" href="a00012.html#MbusSerialMasterProtocolz25_2">closeProtocol</a>();
}


<span class="keywordtype">void</span> runPollLoop()
{
   <span class="keywordtype">short</span> dataArr[10];

   <span class="keywordflow">for</span> (;;)
   {
      <span class="keywordtype">int</span> i;
      <span class="keywordtype">int</span> result;

      result = mbusProtocol.<a class="code" href="a00036.html#a10">readMultipleRegisters</a>(1, 100,
                                                  dataArr,
                                                  <span class="keyword">sizeof</span>(dataArr) / 2);
      <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
         <span class="keywordflow">for</span> (i = 0; i &lt; int(<span class="keyword">sizeof</span>(dataArr) / 2); i++)
            printf(<span class="stringliteral">"[%d]: %hd\n"</span>, 100 + i, dataArr[i]);
      <span class="keywordflow">else</span>
      {
         fprintf(stderr, <span class="stringliteral">"%s!\n"</span>, <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
         <span class="comment">// Stop for fatal errors</span>
         <span class="keywordflow">if</span> (!(result &amp; <a class="code" href="a00041.html#a17">FTALK_BUS_PROTOCOL_ERROR_CLASS</a>))
            <span class="keywordflow">return</span>;
      }

<span class="preprocessor">#ifdef __WIN32__</span>
<span class="preprocessor"></span>      Sleep(1000);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      sleep(1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>   }
}


<span class="keywordtype">int</span> main()
{
   openProtocol();

   runPollLoop();

   closeProtocol();
   <span class="keywordflow">return</span> (EXIT_SUCCESS);
}
</pre></div><h2><a name="example2"></a>
MODBUS/TCP Example</h2>
The following example tcpsimple.cpp shows how to configure a MODBUS/TCP protocol and read values:<p>
<div class="fragment"><pre>
<span class="comment">// Platform header</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>

<span class="comment">// Include FieldTalk package header</span>
<span class="preprocessor">#include "MbusTcpMasterProtocol.hpp"</span>


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Gobal data</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keywordtype">char</span> *hostName = <span class="stringliteral">"127.0.0.1"</span>;
<a class="code" href="a00013.html">MbusTcpMasterProtocol</a> mbusProtocol;


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Function implementation</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keywordtype">void</span> openProtocol()
{
   <span class="keywordtype">int</span> result;

   result = mbusProtocol.<a class="code" href="a00013.html#MbusTcpMasterProtocolz21_0">openProtocol</a>(hostName);
   <span class="keywordflow">if</span> (result != <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
   {
      fprintf(stderr, <span class="stringliteral">"Error opening protocol: %s!\n"</span>,
                       <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
      exit(EXIT_FAILURE);
   }
}


<span class="keywordtype">void</span> closeProtocol()
{
   mbusProtocol.<a class="code" href="a00013.html#MbusTcpMasterProtocolz21_1">closeProtocol</a>();
}


<span class="keywordtype">void</span> runPollLoop()
{
   <span class="keywordtype">short</span> dataArr[10];

   <span class="keywordflow">for</span> (;;)
   {
      <span class="keywordtype">int</span> i;
      <span class="keywordtype">int</span> result;

      result = mbusProtocol.<a class="code" href="a00036.html#a10">readMultipleRegisters</a>(1, 100,
                                                  dataArr,
                                                  <span class="keyword">sizeof</span>(dataArr) / 2);
      <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
         <span class="keywordflow">for</span> (i = 0; i &lt; int(<span class="keyword">sizeof</span>(dataArr) / 2); i++)
            printf(<span class="stringliteral">"[%d]: %hd\n"</span>, 100 + i, dataArr[i]);
      <span class="keywordflow">else</span>
      {
         fprintf(stderr, <span class="stringliteral">"%s!\n"</span>, <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
         <span class="comment">// Stop for fatal errors</span>
         <span class="keywordflow">if</span> (!(result &amp; <a class="code" href="a00041.html#a17">FTALK_BUS_PROTOCOL_ERROR_CLASS</a>))
            <span class="keywordflow">return</span>;
      }

<span class="preprocessor">#ifdef __WIN32__</span>
<span class="preprocessor"></span>      Sleep(1000);
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>      sleep(1);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>   }
}


<span class="keywordtype">int</span> main()
{
   openProtocol();

   runPollLoop();

   closeProtocol();
   <span class="keywordflow">return</span> (EXIT_SUCCESS);
}
</pre></div><h2><a name="example3"></a>
Modpoll application</h2>
The following more complex example modpoll.cpp shows how to use the protocol stack in a context where the user can select the protocol type (TCP, RTU and ASCII) and other parameters. Modpoll is a very useful master simulator and test tool.<p>
<div class="fragment"><pre>
<span class="comment">// Platform header</span>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>

<span class="comment">// Include FieldTalk package header</span>
<span class="preprocessor">#include "MbusRtuMasterProtocol.hpp"</span>
<span class="preprocessor">#include "MbusAsciiMasterProtocol.hpp"</span>
<span class="preprocessor">#include "MbusTcpMasterProtocol.hpp"</span>
<span class="preprocessor">#include "MbusRtuOverTcpMasterProtocol.hpp"</span>

<span class="comment">// Provide getopt on Win32 without using a separate lib</span>
<span class="preprocessor">#ifdef __WIN32__</span>
<span class="preprocessor"></span><span class="preprocessor">#  include "getopt.c"</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#  include &lt;unistd.h&gt;</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>

<span class="comment">/*****************************************************************************</span>
<span class="comment"> * String constants</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keyword">const</span> <span class="keywordtype">char</span> versionStr[]= <span class="stringliteral">"$Revision: 1.15 $"</span>;
<span class="keyword">const</span> <span class="keywordtype">char</span> progName[] = <span class="stringliteral">"modpoll"</span>;
<span class="keyword">const</span> <span class="keywordtype">char</span> bannerStr[] =
<span class="stringliteral">"%s - FieldTalk(tm) Modbus(R) Polling Utility\n"</span>
<span class="stringliteral">"Copyright (c) 2002-2004 FOCUS Software Engineering Pty Ltd\n"</span>
<span class="preprocessor">#ifdef __WIN32__</span>
<span class="preprocessor"></span><span class="stringliteral">"Getopt Library Copyright (C) 1987-1997   Free Software Foundation, Inc.\n"</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>;

<span class="keyword">const</span> <span class="keywordtype">char</span> usageStr[] =
<span class="stringliteral">"%s [options] serialport|host \n"</span>
<span class="stringliteral">"Arguments: \n"</span>
<span class="stringliteral">"serialport    Serial port when using Modbus ASCII or Modbus RTU protocol \n"</span>
<span class="stringliteral">"              /dev/ttyS0, /dev/ttyS1 ...    on Linux \n"</span>
<span class="stringliteral">"              COM1, COM2 ...                on Win32 \n"</span>
<span class="stringliteral">"              /dev/ser1, /dev/ser2 ...      on QNX \n"</span>
<span class="stringliteral">"host          Host name or dotted ip address when using MODBUS/TCP protocol \n"</span>
<span class="stringliteral">"General options: \n"</span>
<span class="stringliteral">"-m ascii      Modbus ASCII protocol\n"</span>
<span class="stringliteral">"-m rtu        Modbus RTU protocol (default)\n"</span>
<span class="stringliteral">"-m tcp        MODBUS/TCP protocol\n"</span>
<span class="stringliteral">"-m enc        Encapsulated Modbus RTU over TCP\n"</span>
<span class="stringliteral">"-a #          Slave address (1-255 for RTU/ASCII, 0-255 for TCP, 1 is default)\n"</span>
<span class="stringliteral">"-r #          Start reference (1-65536, 100 is default)\n"</span>
<span class="stringliteral">"-c #          Number of values to poll (1-100, 1 is default)\n"</span>
<span class="stringliteral">"-t 0          Discrete output (coil) data type\n"</span>
<span class="stringliteral">"-t 1          Discrete input data type\n"</span>
<span class="stringliteral">"-t 3          16-bit input register data type\n"</span>
<span class="stringliteral">"-t 3:hex      16-bit input register data type with hex display\n"</span>
<span class="stringliteral">"-t 3:int      32-bit integer data type in input register table\n"</span>
<span class="stringliteral">"-t 3:mod      32-bit module 10000 data type in input register table\n"</span>
<span class="stringliteral">"-t 3:float    32-bit float data type in input register table\n"</span>
<span class="stringliteral">"-t 4          16-bit output (holding) register data type (default)\n"</span>
<span class="stringliteral">"-t 4:hex      16-bit output (holding) register data type with hex display\n"</span>
<span class="stringliteral">"-t 4:int      32-bit integer data type in output (holding) register table\n"</span>
<span class="stringliteral">"-t 4:mod      32-bit module 10000 type in output (holding) register table\n"</span>
<span class="stringliteral">"-t 4:float    32-bit float data type in output (holding) register table\n"</span>
<span class="stringliteral">"-i            Slave operates on big-endian 32-bit integers\n"</span>
<span class="stringliteral">"-f            Slave operates on big-endian 32-bit floats\n"</span>
<span class="stringliteral">"-1            Poll only once, otherwise poll every second\n"</span>
<span class="stringliteral">"Options for MODBUS/TCP:\n"</span>
<span class="stringliteral">"-p #          TCP port number (502 is default)\n"</span>
<span class="stringliteral">"Options for Modbus ASCII and Modbus RTU:\n"</span>
<span class="stringliteral">"-b #          Baudrate (e.g. 9600, 19200, ...) (9600 is default)\n"</span>
<span class="stringliteral">"-d #          Databits (7 or 8 for ASCII protocol, 8 for RTU)\n"</span>
<span class="stringliteral">"-s #          Stopbits (1 or 2, 1 is default)\n"</span>
<span class="stringliteral">"-p none       No parity (default)\n"</span>
<span class="stringliteral">"-p even       Even parity\n"</span>
<span class="stringliteral">"-p odd        Odd parity\n"</span>
<span class="stringliteral">"-4 #          RS485 mode, RTS on while transmitting and another # ms after.\n"</span>
<span class="stringliteral">""</span>;


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Enums</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keyword">enum</span>
{
   RTU,       
   ASCII,     
   TCP,       
   RTUOVERTCP 
};

<span class="keyword">enum</span>
{
   T0_BOOL,     
   T1_BOOL,     
   T3_REG16,    
   T3_HEX16,    
   T3_INT32,    
   T3_MOD10000, 
   T3_FLOAT32,  
   T4_REG16,    
   T4_HEX16,    
   T4_INT32,    
   T4_MOD10000, 
   T4_FLOAT32   
};


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Gobal configuration data</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keywordtype">int</span> address = 1;
<span class="keywordtype">int</span> ref = 100;
<span class="keywordtype">int</span> refCnt = 1;
<span class="keywordtype">int</span> pollCnt = -1;
<span class="keywordtype">long</span> baudRate = 9600;
<span class="keywordtype">int</span> dataBits = 8;
<span class="keywordtype">int</span> stopBits = 1;
<span class="keywordtype">int</span> parity = <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw4">MbusSerialMasterProtocol::SER_PARITY_NONE</a>;
<span class="keywordtype">int</span> protocol = RTU;
<span class="keywordtype">int</span> dataType = T4_REG16;
<span class="keywordtype">int</span> swapInts = 0;
<span class="keywordtype">int</span> swapFloats = 0;
<span class="keywordtype">char</span> *portName = NULL;
<span class="keywordtype">int</span> port = 502;
<span class="keywordtype">int</span> rs485Mode = 0;


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Protocol and data pointers</span>
<span class="comment"> *****************************************************************************/</span>

<a class="code" href="a00009.html">MbusMasterFunctions</a> *mbusPtr = NULL;
<span class="keywordtype">void</span> *dataPtr = NULL;


<span class="comment">/*****************************************************************************</span>
<span class="comment"> * Function implementation</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keywordtype">void</span> printUsage()
{
   printf(<span class="stringliteral">"Usage: "</span>);
   printf(usageStr, progName);
   exit(EXIT_SUCCESS);
}


<span class="keywordtype">void</span> printVersion()
{
   printf(bannerStr, progName);
   printf(<span class="stringliteral">"Version: %s using FieldTalk package version %s\n"</span>,
          versionStr, MbusMasterFunctions::getPackageVersion());
}


<span class="keywordtype">void</span> printConfig()
{
   printf(bannerStr, progName);
   printf(<span class="stringliteral">"Protocol configuration: "</span>);
   <span class="keywordflow">switch</span> (protocol)
   {
      <span class="keywordflow">case</span> RTU:
         printf(<span class="stringliteral">"Modbus RTU\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> ASCII:
         printf(<span class="stringliteral">"Modbus ASCII\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> TCP:
         printf(<span class="stringliteral">"MODBUS/TCP\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> RTUOVERTCP:
         printf(<span class="stringliteral">"Encapsulated RTU over TCP\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">default</span>:
         printf(<span class="stringliteral">"unknown\n"</span>);
      <span class="keywordflow">break</span>;
   }
   printf(<span class="stringliteral">"Slave configuration: "</span>);
   printf(<span class="stringliteral">"Address = %d, "</span>, address);
   printf(<span class="stringliteral">"start reference = %d, "</span>, ref);
   printf(<span class="stringliteral">"count = %d\n"</span>, refCnt);
   <span class="keywordflow">if</span> ((protocol == TCP) || (protocol == RTUOVERTCP))
   {
      printf(<span class="stringliteral">"TCP/IP configuration: "</span>);
      printf(<span class="stringliteral">"Host = %s, "</span>, portName);
      printf(<span class="stringliteral">"port = %d\n"</span>, port);
   }
   <span class="keywordflow">else</span>
   {
      printf(<span class="stringliteral">"Serial port configuration: "</span>);
      printf(<span class="stringliteral">"%s, "</span>, portName);
      printf(<span class="stringliteral">"%ld, "</span>, baudRate);
      printf(<span class="stringliteral">"%d, "</span>, dataBits);
      printf(<span class="stringliteral">"%d, "</span>, stopBits);
      <span class="keywordflow">switch</span> (parity)
      {
         <span class="keywordflow">case</span> <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw4">MbusSerialMasterProtocol::SER_PARITY_NONE</a>:
            printf(<span class="stringliteral">"none\n"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw5">MbusSerialMasterProtocol::SER_PARITY_EVEN</a>:
            printf(<span class="stringliteral">"even\n"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw6">MbusSerialMasterProtocol::SER_PARITY_ODD</a>:
            printf(<span class="stringliteral">"odd\n"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">default</span>:
            printf(<span class="stringliteral">"unknown\n"</span>);
         <span class="keywordflow">break</span>;
      }
   }
   printf(<span class="stringliteral">"Data type: "</span>);
   <span class="keywordflow">switch</span> (dataType)
   {
      <span class="keywordflow">case</span> T0_BOOL:
         printf(<span class="stringliteral">"discrete output (coil)\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T1_BOOL:
         printf(<span class="stringliteral">"discrete input\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_REG16:
         printf(<span class="stringliteral">"16-bit register, input register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_HEX16:
         printf(<span class="stringliteral">"16-bit register (hex), input register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_INT32:
         printf(<span class="stringliteral">"32-bit integer, input register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_MOD10000:
         printf(<span class="stringliteral">"32-bit module 10000, input register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_FLOAT32:
         printf(<span class="stringliteral">"32-bit float, input register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T4_REG16:
         printf(<span class="stringliteral">"16-bit register, output (holding) register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T4_HEX16:
         printf(<span class="stringliteral">"16-bit register (hex), output (holding) register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T4_INT32:
         printf(<span class="stringliteral">"32-bit integer, output (holding) register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T4_MOD10000:
         printf(<span class="stringliteral">"32-bit module 10000, output (holding) register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T4_FLOAT32:
         printf(<span class="stringliteral">"32-bit float, output (holding) register table\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">default</span>:
         printf(<span class="stringliteral">"unknown\n"</span>);
      <span class="keywordflow">break</span>;
   }
   <span class="keywordflow">if</span> (swapInts || swapFloats)
   {
      printf(<span class="stringliteral">"Word swapping: Slave configured as big-endian"</span>);
      <span class="keywordflow">if</span> (swapInts)
         printf(<span class="stringliteral">" word"</span>);
      <span class="keywordflow">if</span> (swapInts &amp;&amp; swapFloats)
         printf(<span class="stringliteral">" and"</span>);
      <span class="keywordflow">if</span> (swapFloats)
         printf(<span class="stringliteral">" float"</span>);
      printf(<span class="stringliteral">" machine\n"</span>);
   }
   printf(<span class="stringliteral">"\n"</span>);
}


<span class="keywordtype">void</span> exitBadOption(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> text)
{
   fprintf(stderr, <span class="stringliteral">"%s: %s! Try -h for help.\n"</span>, progName, text);
   exit(EXIT_FAILURE);
}


<span class="keywordtype">void</span> scanOptions(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
   <span class="keywordtype">int</span> c;

   <span class="comment">// Check for --version option</span>
   <span class="keywordflow">for</span> (c = 1; c &lt; argc; c++)
   {
      <span class="keywordflow">if</span> (strcmp (argv[c], <span class="stringliteral">"--version"</span>) == 0)
      {
         printVersion();
         exit(EXIT_SUCCESS);
      }
   }

   <span class="comment">// Check for --help option</span>
   <span class="keywordflow">for</span> (c = 1; c &lt; argc; c++)
   {
      <span class="keywordflow">if</span> (strcmp (argv[c], <span class="stringliteral">"--help"</span>) == 0)
         printUsage();
   }

   opterr = 0; <span class="comment">// Disable getopt's error messages</span>
   <span class="keywordflow">for</span> (;;)
   {
      c = getopt(argc, argv, <span class="stringliteral">"h14:fa:r:c:b:d:s:p:t:m:"</span>);
      <span class="keywordflow">if</span> (c == -1)
         <span class="keywordflow">break</span>;

      <span class="keywordflow">switch</span> (c)
      {
         <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
            pollCnt = 1;
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
            rs485Mode = (<span class="keywordtype">int</span>) strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> ((rs485Mode &lt;= 0) || (rs485Mode &gt; 1000))
               exitBadOption(<span class="stringliteral">"Invalid RTS delay parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
            swapInts = 1;
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
            swapFloats = 1;
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'m'</span>:
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"tcp"</span>) == 0)
            {
               protocol = TCP;
            }
            <span class="keywordflow">else</span>
               <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"rtu"</span>) == 0)
               {
                  protocol = RTU;
               }
               <span class="keywordflow">else</span>
                  <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"ascii"</span>) == 0)
                  {
                     protocol = ASCII;
                  }
                  <span class="keywordflow">else</span>
                     <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"enc"</span>) == 0)
                     {
                        protocol = RTUOVERTCP;
                     }
                     <span class="keywordflow">else</span>
                     {
                        exitBadOption(<span class="stringliteral">"Invalid protocol parameter"</span>);
                     }
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
            address = strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> ((address &lt; 0) || (address &gt; 255))
               exitBadOption(<span class="stringliteral">"Invalid address parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
            ref = strtol(optarg, NULL, 0);
             <span class="keywordflow">if</span> ((ref &lt;= 0) || (ref &gt; 0x10000))
               exitBadOption(<span class="stringliteral">"Invalid reference parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
            refCnt = strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> ((refCnt &lt;= 0) || (refCnt &gt;= 100))
               exitBadOption(<span class="stringliteral">"Invalid count parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
            baudRate = strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> (baudRate == 0)
               exitBadOption(<span class="stringliteral">"Invalid baudrate parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
            dataBits = (<span class="keywordtype">int</span>) strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> ((dataBits != 7) || (dataBits != 8))
               exitBadOption(<span class="stringliteral">"Invalid databits parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
            stopBits = (<span class="keywordtype">int</span>) strtol(optarg, NULL, 0);
            <span class="keywordflow">if</span> ((stopBits != 1) || (stopBits != 2))
               exitBadOption(<span class="stringliteral">"Invalid stopbits parameter"</span>);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"none"</span>) == 0)
            {
               parity = <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw4">MbusSerialMasterProtocol::SER_PARITY_NONE</a>;
            }
            <span class="keywordflow">else</span>
               <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"odd"</span>) == 0)
               {
                  parity = <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw6">MbusSerialMasterProtocol::SER_PARITY_ODD</a>;
               }
               <span class="keywordflow">else</span>
                  <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"even"</span>) == 0)
                  {
                     parity = <a class="code" href="a00012.html#MbusSerialMasterProtocolw9MbusSerialMasterProtocolw5">MbusSerialMasterProtocol::SER_PARITY_EVEN</a>;
                  }
                  <span class="keywordflow">else</span>
                  {
                     port = strtol(optarg, NULL, 0);
                     <span class="keywordflow">if</span> ((port &lt;= 0) || (port &gt; 0xFFFF))
                        exitBadOption(<span class="stringliteral">"Invalid parity or port parameter"</span>);
                  }
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"0"</span>) == 0)
            {
               dataType = T0_BOOL;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"1"</span>) == 0)
            {
               dataType = T1_BOOL;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"3"</span>) == 0)
            {
               dataType = T3_REG16;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"3:hex"</span>) == 0)
            {
               dataType = T3_HEX16;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"3:int"</span>) == 0)
            {
               dataType = T3_INT32;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"3:mod"</span>) == 0)
            {
               dataType = T3_MOD10000;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"3:float"</span>) == 0)
            {
               dataType = T3_FLOAT32;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"4"</span>) == 0)
            {
               dataType = T4_REG16;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"4:hex"</span>) == 0)
            {
               dataType = T4_HEX16;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"4:int"</span>) == 0)
            {
               dataType = T4_INT32;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"4:mod"</span>) == 0)
            {
               dataType = T4_MOD10000;
            }
            <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (strcmp(optarg, <span class="stringliteral">"4:float"</span>) == 0)
            {
               dataType = T4_FLOAT32;
            }
            <span class="keywordflow">else</span>
            {
               exitBadOption(<span class="stringliteral">"Invalid data type parameter"</span>);
            }
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
            printUsage();
         <span class="keywordflow">break</span>;
         <span class="keywordflow">default</span>:
            exitBadOption(<span class="stringliteral">"Unrecognized option or missing option parameter"</span>);
         <span class="keywordflow">break</span>;
      }
   }

   <span class="keywordflow">if</span> ((argc - optind) != 1)
         exitBadOption(<span class="stringliteral">"Invalid number of parameters"</span>);
   <span class="keywordflow">else</span>
      portName = argv[optind];
}


<span class="keywordtype">void</span> openProtocol()
{
   <span class="keywordtype">int</span> result = -1;

   <span class="keywordflow">switch</span> (protocol)
   {
      <span class="keywordflow">case</span> RTU:
         mbusPtr = <span class="keyword">new</span> <a class="code" href="a00010.html">MbusRtuMasterProtocol</a>();
         <span class="keywordflow">if</span> (!mbusPtr)
         {
            fprintf(stderr, <span class="stringliteral">"Out of memory!\n"</span>);
            exit(EXIT_FAILURE);
         }
         <span class="keywordflow">if</span> (swapInts)
            mbusPtr-&gt;<a class="code" href="a00036.html#a5">configureBigEndianInts</a>();
         <span class="keywordflow">if</span> (swapFloats)
            mbusPtr-&gt;<a class="code" href="a00036.html#a32">configureSwappedFloats</a>();
         mbusPtr-&gt;<a class="code" href="a00036.html#a27">setRetryCnt</a>(2);
         mbusPtr-&gt;<a class="code" href="a00036.html#a25">setPollDelay</a>(1000);
         <span class="keywordflow">if</span> (rs485Mode &gt; 0)
            ((<a class="code" href="a00008.html">MbusAsciiMasterProtocol</a> *) mbusPtr)-&gt;enableRs485Mode(rs485Mode);
         result = ((MbusRtuMasterProtocol *) mbusPtr)-&gt;openProtocol(
                   portName, baudRate, dataBits, stopBits, parity);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> ASCII:
         mbusPtr = <span class="keyword">new</span> <a class="code" href="a00008.html">MbusAsciiMasterProtocol</a>();
         <span class="keywordflow">if</span> (!mbusPtr)
         {
            fprintf(stderr, <span class="stringliteral">"Out of memory!\n"</span>);
            exit(EXIT_FAILURE);
         }
         <span class="keywordflow">if</span> (swapInts)
            mbusPtr-&gt;<a class="code" href="a00036.html#a5">configureBigEndianInts</a>();
         <span class="keywordflow">if</span> (swapFloats)
            mbusPtr-&gt;<a class="code" href="a00036.html#a32">configureSwappedFloats</a>();
         mbusPtr-&gt;<a class="code" href="a00036.html#a27">setRetryCnt</a>(2);
         mbusPtr-&gt;<a class="code" href="a00036.html#a25">setPollDelay</a>(1000);
         <span class="keywordflow">if</span> (rs485Mode &gt; 0)
            ((MbusAsciiMasterProtocol *) mbusPtr)-&gt;enableRs485Mode(rs485Mode);
         result = ((MbusAsciiMasterProtocol *) mbusPtr)-&gt;openProtocol(
                   portName, baudRate, dataBits, stopBits, parity);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> TCP:
         mbusPtr = <span class="keyword">new</span> <a class="code" href="a00013.html">MbusTcpMasterProtocol</a>();
         <span class="keywordflow">if</span> (!mbusPtr)
         {
            fprintf(stderr, <span class="stringliteral">"Out of memory!\n"</span>);
            exit(EXIT_FAILURE);
         }
         <span class="keywordflow">if</span> (swapInts)
            mbusPtr-&gt;<a class="code" href="a00036.html#a5">configureBigEndianInts</a>();
         <span class="keywordflow">if</span> (swapFloats)
            mbusPtr-&gt;<a class="code" href="a00036.html#a32">configureSwappedFloats</a>();
         mbusPtr-&gt;<a class="code" href="a00036.html#a25">setPollDelay</a>(1000);
         ((MbusTcpMasterProtocol *) mbusPtr)-&gt;setPort(port);
         result = ((MbusTcpMasterProtocol *) mbusPtr)-&gt;openProtocol(portName);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> RTUOVERTCP:
         mbusPtr = <span class="keyword">new</span> <a class="code" href="a00011.html">MbusRtuOverTcpMasterProtocol</a>();
         <span class="keywordflow">if</span> (!mbusPtr)
         {
            fprintf(stderr, <span class="stringliteral">"Out of memory!\n"</span>);
            exit(EXIT_FAILURE);
         }
         <span class="keywordflow">if</span> (swapInts)
            mbusPtr-&gt;<a class="code" href="a00036.html#a5">configureBigEndianInts</a>();
         <span class="keywordflow">if</span> (swapFloats)
            mbusPtr-&gt;<a class="code" href="a00036.html#a32">configureSwappedFloats</a>();
         mbusPtr-&gt;<a class="code" href="a00036.html#a25">setPollDelay</a>(1000);
         ((MbusRtuOverTcpMasterProtocol *) mbusPtr)-&gt;setPort(port);
         result = ((MbusRtuOverTcpMasterProtocol *) mbusPtr)-&gt;openProtocol(portName);
      <span class="keywordflow">break</span>;
   }
   <span class="keywordflow">switch</span> (result)
   {
      <span class="keywordflow">case</span> <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>:
         printf(<span class="stringliteral">"Protocol opened successfully.\n"</span>);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="a00041.html#a2">FTALK_ILLEGAL_ARGUMENT_ERROR</a>:
         fprintf(stderr, <span class="stringliteral">"Configuration setting not supported!\n"</span>);
         exit(EXIT_FAILURE);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="a00041.html#a9">FTALK_TCPIP_CONNECT_ERR</a>:
         fprintf(stderr, <span class="stringliteral">"Can't reach slave (check ip address)!\n"</span>);
         exit(EXIT_FAILURE);
      <span class="keywordflow">break</span>;
      <span class="keywordflow">default</span>:
         fprintf(stderr, <span class="stringliteral">"%s!\n"</span>, <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
         exit(EXIT_FAILURE);
      <span class="keywordflow">break</span>;
   }

   <span class="keywordflow">switch</span> (dataType)
   {
      <span class="keywordflow">case</span> T3_HEX16:
      <span class="keywordflow">case</span> T3_REG16:
      <span class="keywordflow">case</span> T4_HEX16:
      <span class="keywordflow">case</span> T4_REG16:
         dataPtr = <span class="keyword">new</span> <span class="keywordtype">short</span>[refCnt];
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T0_BOOL:
      <span class="keywordflow">case</span> T1_BOOL:
      <span class="keywordflow">case</span> T3_INT32:
      <span class="keywordflow">case</span> T4_INT32:
      <span class="keywordflow">case</span> T3_MOD10000:
      <span class="keywordflow">case</span> T4_MOD10000:
         dataPtr = <span class="keyword">new</span> <span class="keywordtype">int</span>[refCnt];
      <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> T3_FLOAT32:
      <span class="keywordflow">case</span> T4_FLOAT32:
         dataPtr = <span class="keyword">new</span> <span class="keywordtype">float</span>[refCnt];
      <span class="keywordflow">break</span>;
   }
   <span class="keywordflow">if</span> (!dataPtr)
   {
      fprintf(stderr, <span class="stringliteral">"Out of memory!\n"</span>);
      exit(EXIT_FAILURE);
   }
}


<span class="keywordtype">void</span> closeProtocol()
{
   <span class="keyword">delete</span> mbusPtr;
   <span class="keyword">delete</span> [] dataPtr;
}


<span class="keywordtype">void</span> pollSlave()
{
   <span class="keywordtype">int</span> i;
   <span class="keywordtype">int</span> result = -1;

   <span class="keywordflow">while</span> ((pollCnt == -1) || (pollCnt &gt; 0))
   {
      <span class="keywordflow">if</span> (pollCnt == -1)
         printf(<span class="stringliteral">"Polling slave (Ctrl-C to stop) ...\n"</span>);
      <span class="keywordflow">else</span>
      {
         printf(<span class="stringliteral">"Polling slave ...\n"</span>);
         pollCnt--;
      }
      <span class="keywordflow">switch</span> (dataType)
      {
         <span class="keywordflow">case</span> T0_BOOL:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a1">readCoils</a>(address, ref,
                                        (<span class="keywordtype">int</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T1_BOOL:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a14">readInputDiscretes</a>(address, ref,
                                                 (<span class="keywordtype">int</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T4_REG16:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a10">readMultipleRegisters</a>(address, ref,
                                                    (<span class="keywordtype">short</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %hd\n"</span>, ref + i, ((<span class="keywordtype">short</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T4_HEX16:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a10">readMultipleRegisters</a>(address, ref,
                                                    (<span class="keywordtype">short</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: 0x%04hX\n"</span>, ref + i, ((<span class="keywordtype">short</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T4_INT32:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a11">readMultipleLongInts</a>(address, ref,
                                                   (<span class="keywordtype">long</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i * 2, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T4_MOD10000:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a12">readMultipleMod10000</a>(address, ref,
                                                   (<span class="keywordtype">long</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i * 2, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T4_FLOAT32:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a13">readMultipleFloats</a>(address, ref,
                                                 (<span class="keywordtype">float</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %f\n"</span>, ref + i * 2, ((<span class="keywordtype">float</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T3_REG16:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a15">readInputRegisters</a>(address, ref,
                                                 (<span class="keywordtype">short</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %hd\n"</span>, ref + i, ((<span class="keywordtype">short</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T3_HEX16:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a15">readInputRegisters</a>(address, ref,
                                                 (<span class="keywordtype">short</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: 0x%04hX\n"</span>, ref + i, ((<span class="keywordtype">short</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T3_INT32:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a16">readInputLongInts</a>(address, ref,
                                                (<span class="keywordtype">long</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i * 2, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T3_MOD10000:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a17">readInputMod10000</a>(address, ref,
                                                (<span class="keywordtype">long</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %d\n"</span>, ref + i * 2, ((<span class="keywordtype">int</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
         <span class="keywordflow">case</span> T3_FLOAT32:
            result = mbusPtr-&gt;<a class="code" href="a00036.html#a18">readInputFloats</a>(address, ref,
                                              (<span class="keywordtype">float</span> *) dataPtr, refCnt);
            <span class="keywordflow">if</span> (result == <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
               <span class="keywordflow">for</span> (i = 0; i &lt; refCnt; i++)
                  printf(<span class="stringliteral">"[%d]: %f\n"</span>, ref + i * 2, ((<span class="keywordtype">float</span> *) dataPtr)[i]);
         <span class="keywordflow">break</span>;
      }
      <span class="keywordflow">if</span> (result != <a class="code" href="a00041.html#a1">FTALK_SUCCESS</a>)
      {
         fprintf(stderr, <span class="stringliteral">"%s!\n"</span>, <a class="code" href="a00041.html#a28">getBusProtocolErrorText</a>(result));
         <span class="comment">// Stop for fatal errors</span>
         <span class="keywordflow">if</span> (!(result &amp; <a class="code" href="a00041.html#a17">FTALK_BUS_PROTOCOL_ERROR_CLASS</a>))
            <span class="keywordflow">return</span>;
      }
   }
}


<span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
   scanOptions(argc, argv);
   printConfig();
   atexit(closeProtocol);
   openProtocol();
   pollSlave();
   <span class="keywordflow">return</span> (EXIT_SUCCESS);
}
</pre></div> <!-- <?php echo "--".">";
siteFooter();
echo "<"."!--"; if (false) { ?> -->
   <hr>
   <table width="100%" cellspacing=0 cellpadding=5 border=0>
      <tr>
         <td class=footer valign=top>
         Copyright &copy; 2002-2004 <a href="http://www.focus-sw.com">
         FOCUS Software Engineering Pty Ltd</a>, Australia.
         All rights reserved.
         <br>
         Please see the <a href="notices.html">Notices</a> page for trademark notices.
         <br>
         Last updated: 26 May 2004
     </tr>
   </table>

</body>
</html>
<!-- <?php } echo "--".">"; echo "<"."!--"; ?> -->

